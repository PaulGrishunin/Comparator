{"ast":null,"code":"import _objectWithoutProperties from 'babel-runtime/helpers/objectWithoutProperties';\nimport _extends from 'babel-runtime/helpers/extends';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _createClass from 'babel-runtime/helpers/createClass';\nimport _inherits from 'babel-runtime/helpers/inherits';\nimport React from 'react';\nimport ReactDom from 'react-dom';\nimport PropTypes from 'prop-types';\nimport easingTypes from 'tween-functions';\nimport { Tween as Timeline } from 'rc-tween-one';\nimport ticker from 'rc-tween-one/es/ticker';\nimport EventListener from './EventDispatcher';\nimport { noop, dataToArray, objectEqual, currentScrollTop, windowHeight } from './util';\nvar tickerId = 0;\n\nfunction playScaleToArray(playScale) {\n  if (Array.isArray(playScale)) {\n    if (playScale.length === 2) {\n      return playScale;\n    }\n\n    return [playScale[0] || 0, playScale[1] || 1];\n  } else if (playScale) {\n    return [playScale, 1];\n  }\n\n  return [0, 1];\n}\n\nvar ScrollParallax = function (_React$Component) {\n  _inherits(ScrollParallax, _React$Component);\n\n  _createClass(ScrollParallax, null, [{\n    key: 'getDerivedStateFromProps',\n    value: function getDerivedStateFromProps(props, _ref) {\n      var prevProps = _ref.prevProps,\n          $self = _ref.$self;\n      var nextState = {\n        prevProps: props\n      };\n\n      if (prevProps && props !== prevProps) {\n        var equal = objectEqual(prevProps.animation, props.animation);\n\n        if (!equal) {\n          $self.setDefaultData(props.animation || {});\n          $self.timeline.resetAnimData();\n          $self.timeline.setDefaultData($self.defaultTweenData);\n        }\n      }\n\n      return nextState; // eslint-disable-line\n    }\n  }]);\n\n  function ScrollParallax(props) {\n    _classCallCheck(this, ScrollParallax);\n\n    var _this = _possibleConstructorReturn(this, (ScrollParallax.__proto__ || Object.getPrototypeOf(ScrollParallax)).call(this, props));\n\n    _this.setDefaultData = function (_vars) {\n      var vars = dataToArray(_vars);\n\n      var varsForIn = function varsForIn(item, i) {\n        var playScale = playScaleToArray(item.playScale).map(function (data) {\n          return data * _this.clientHeight;\n        });\n\n        var aItem = _extends({}, item);\n\n        delete aItem.playScale;\n\n        var cItem = _extends({}, item);\n\n        delete cItem.playScale;\n        cItem.delay = playScale[0];\n        aItem.delay = playScale[0];\n        cItem.duration = playScale[1] - playScale[0];\n        aItem.duration = playScale[1] - playScale[0];\n        cItem.onStart = null;\n        cItem.onUpdate = null;\n        cItem.onComplete = null;\n        cItem.onRepeat = null;\n        aItem.onStart = aItem.onStart || noop;\n        aItem.onComplete = aItem.onComplete || noop;\n        aItem.onUpdate = aItem.onUpdate || noop;\n        aItem.onStartBack = aItem.onStartBack || noop;\n        aItem.onCompleteBack = aItem.onCompleteBack || noop;\n        _this.defaultTweenData[i] = cItem;\n        _this.defaultData[i] = aItem;\n      };\n\n      vars.forEach(varsForIn);\n    };\n\n    _this.resizeEventListener = function () {\n      if (_this.defaultData[_this.defaultData.length - 1] && _this.defaultData[_this.defaultData.length - 1].onCompleteBool && !_this.props.always) {\n        return;\n      }\n\n      _this.scrollTop = currentScrollTop();\n      _this.target = _this.props.targetId && document.getElementById(_this.props.targetId);\n      _this.clientHeight = _this.target ? _this.target.clientHeight : windowHeight();\n\n      _this.setDefaultData(_this.props.animation || {});\n\n      if (_this.timeline) {\n        _this.timeline.resetDefaultStyle();\n      }\n\n      _this.timeline = new Timeline(_this.dom, _this.defaultTweenData);\n\n      _this.timeline.init();\n\n      _this.scrollEventListener();\n    };\n\n    _this.scrollEventListener = function () {\n      var scrollTop = _this.target ? _this.target.scrollTop : currentScrollTop();\n      _this.clientHeight = _this.target ? _this.target.clientHeight : windowHeight();\n      var dom = _this.props.location ? document.getElementById(_this.props.location) : _this.dom;\n\n      if (!dom) {\n        throw new Error('\"location\" is null');\n      }\n\n      var targetTop = _this.target ? _this.target.getBoundingClientRect().top : 0;\n      var offsetTop = dom.getBoundingClientRect().top + scrollTop - targetTop;\n      var elementShowHeight = scrollTop - offsetTop + _this.clientHeight;\n      var currentShow = _this.scrollTop - offsetTop + _this.clientHeight;\n\n      _this.defaultData.forEach(function (item, i) {\n        var duration = _this.defaultData.map(function (c, ii) {\n          return ii < i && c.delay + c.duration || 0;\n        }).reduce(function (a, b) {\n          return a + b;\n        });\n\n        var noUpdate = void 0;\n\n        if (elementShowHeight <= item.delay + duration) {\n          if (!item.onCompleteBackBool && item.onStartBool) {\n            item.onCompleteBackBool = true;\n            noUpdate = true;\n            item.onCompleteBack();\n          }\n        } else {\n          item.onCompleteBackBool = false;\n        }\n\n        if (elementShowHeight >= item.delay + duration) {\n          if (!item.onStartBool) {\n            item.onStartBool = true;\n            noUpdate = true;\n            item.onStart();\n          }\n        } else {\n          item.onStartBool = false;\n        }\n\n        if (elementShowHeight <= item.delay + item.duration + duration) {\n          if (!item.onStartBackBool && item.onCompleteBool) {\n            item.onStartBackBool = true;\n            noUpdate = true;\n            item.onStartBack();\n          }\n        } else {\n          item.onStartBackBool = false;\n        }\n\n        if (elementShowHeight >= item.delay + item.duration + duration) {\n          if (!item.onCompleteBool) {\n            item.onCompleteBool = true;\n            noUpdate = true;\n            item.onComplete();\n          }\n        } else {\n          item.onCompleteBool = false;\n        }\n\n        if (elementShowHeight >= item.delay + duration && elementShowHeight <= item.delay + item.duration + duration && !noUpdate) {\n          item.onUpdate(elementShowHeight / (item.delay + item.duration + duration));\n        }\n      });\n\n      ticker.clear(_this.tickerId);\n      _this.tickerId = 'scrollParallax' + Date.now() + '-' + tickerId;\n      tickerId++;\n\n      if (tickerId >= Number.MAX_VALUE) {\n        tickerId = 0;\n      }\n\n      var startFrame = ticker.frame;\n      ticker.wake(_this.tickerId, function () {\n        var moment = (ticker.frame - startFrame) * ticker.perFrame;\n        var ratio = easingTypes.easeOutQuad(moment, 0.08, 1, 300);\n\n        _this.timeline.frame(currentShow + ratio * (elementShowHeight - currentShow));\n\n        if (moment >= 300) {\n          ticker.clear(_this.tickerId);\n        }\n      });\n      _this.scrollTop = scrollTop; // 如果不一直靠滚动来执行动画，always=false而且动画全执行完了，，删除scrollEvent;\n\n      if (_this.defaultData[_this.defaultData.length - 1].onCompleteBool && _this.eventType && !_this.props.always) {\n        EventListener.removeEventListener(_this.eventType, _this.scrollEventListener, _this.target);\n      }\n    };\n\n    _this.scrollTop = 0;\n    _this.defaultTweenData = [];\n    _this.defaultData = [];\n    _this.state = {\n      $self: _this\n    };\n    return _this;\n  }\n\n  _createClass(ScrollParallax, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this.dom = ReactDom.findDOMNode(this);\n      var date = Date.now();\n      var length = EventListener._listeners.scroll ? EventListener._listeners.scroll.length : 0;\n      this.eventType = 'scroll.scrollEvent' + date + length;\n      this.eventResize = 'resize.resizeEvent' + date + length;\n      this.resizeEventListener();\n      EventListener.addEventListener(this.eventResize, this.resizeEventListener, this.target); // 预注册;\n\n      this.timeline.frame(0);\n      this.scrollEventListener();\n      EventListener.addEventListener(this.eventType, this.scrollEventListener, this.target);\n    }\n  }, {\n    key: 'componentWillUnmount',\n    value: function componentWillUnmount() {\n      EventListener.removeEventListener(this.eventType, this.scrollEventListener, this.target);\n      EventListener.removeEventListener(this.eventResize, this.resizeEventListener, this.target);\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _props = this.props,\n          animation = _props.animation,\n          always = _props.always,\n          component = _props.component,\n          location = _props.location,\n          targetId = _props.targetId,\n          componentProps = _props.componentProps,\n          props = _objectWithoutProperties(_props, ['animation', 'always', 'component', 'location', 'targetId', 'componentProps']);\n\n      var style = _extends({}, props.style);\n\n      Object.keys(style).forEach(function (p) {\n        if (p.indexOf('filter') >= 0 || p.indexOf('Filter') >= 0) {\n          // ['Webkit', 'Moz', 'Ms', 'ms'].forEach(prefix=> style[`${prefix}Filter`] = style[p]);\n          var transformArr = ['Webkit', 'Moz', 'Ms', 'ms'];\n\n          for (var i = 0; i < transformArr.length; i++) {\n            style[transformArr[i] + 'Filter'] = style[p];\n          }\n        }\n      });\n      props.style = style;\n      return React.createElement(this.props.component, _extends({}, props, componentProps));\n    }\n  }]);\n\n  return ScrollParallax;\n}(React.Component);\n\nScrollParallax.propTypes = {\n  component: PropTypes.any,\n  animation: PropTypes.any,\n  always: PropTypes.bool,\n  location: PropTypes.string,\n  children: PropTypes.any,\n  className: PropTypes.string,\n  style: PropTypes.any,\n  id: PropTypes.string,\n  targetId: PropTypes.string,\n  componentProps: PropTypes.object\n};\nScrollParallax.defaultProps = {\n  component: 'div',\n  always: true,\n  componentProps: {}\n};\nScrollParallax.isScrollParallax = true;\nexport default ScrollParallax;","map":{"version":3,"sources":["/home/paul/Comparator/frontend/node_modules/rc-scroll-anim/es/ScrollParallax.js"],"names":["_objectWithoutProperties","_extends","_classCallCheck","_possibleConstructorReturn","_createClass","_inherits","React","ReactDom","PropTypes","easingTypes","Tween","Timeline","ticker","EventListener","noop","dataToArray","objectEqual","currentScrollTop","windowHeight","tickerId","playScaleToArray","playScale","Array","isArray","length","ScrollParallax","_React$Component","key","value","getDerivedStateFromProps","props","_ref","prevProps","$self","nextState","equal","animation","setDefaultData","timeline","resetAnimData","defaultTweenData","_this","__proto__","Object","getPrototypeOf","call","_vars","vars","varsForIn","item","i","map","data","clientHeight","aItem","cItem","delay","duration","onStart","onUpdate","onComplete","onRepeat","onStartBack","onCompleteBack","defaultData","forEach","resizeEventListener","onCompleteBool","always","scrollTop","target","targetId","document","getElementById","resetDefaultStyle","dom","init","scrollEventListener","location","Error","targetTop","getBoundingClientRect","top","offsetTop","elementShowHeight","currentShow","c","ii","reduce","a","b","noUpdate","onCompleteBackBool","onStartBool","onStartBackBool","clear","Date","now","Number","MAX_VALUE","startFrame","frame","wake","moment","perFrame","ratio","easeOutQuad","eventType","removeEventListener","state","componentDidMount","findDOMNode","date","_listeners","scroll","eventResize","addEventListener","componentWillUnmount","render","_props","component","componentProps","style","keys","p","indexOf","transformArr","createElement","Component","propTypes","any","bool","string","children","className","id","object","defaultProps","isScrollParallax"],"mappings":"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","sourcesContent":["import _objectWithoutProperties from 'babel-runtime/helpers/objectWithoutProperties';\nimport _extends from 'babel-runtime/helpers/extends';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _createClass from 'babel-runtime/helpers/createClass';\nimport _inherits from 'babel-runtime/helpers/inherits';\nimport React from 'react';\nimport ReactDom from 'react-dom';\nimport PropTypes from 'prop-types';\nimport easingTypes from 'tween-functions';\nimport { Tween as Timeline } from 'rc-tween-one';\nimport ticker from 'rc-tween-one/es/ticker';\n\nimport EventListener from './EventDispatcher';\nimport { noop, dataToArray, objectEqual, currentScrollTop, windowHeight } from './util';\n\nvar tickerId = 0;\n\nfunction playScaleToArray(playScale) {\n  if (Array.isArray(playScale)) {\n    if (playScale.length === 2) {\n      return playScale;\n    }\n    return [playScale[0] || 0, playScale[1] || 1];\n  } else if (playScale) {\n    return [playScale, 1];\n  }\n  return [0, 1];\n}\n\nvar ScrollParallax = function (_React$Component) {\n  _inherits(ScrollParallax, _React$Component);\n\n  _createClass(ScrollParallax, null, [{\n    key: 'getDerivedStateFromProps',\n    value: function getDerivedStateFromProps(props, _ref) {\n      var prevProps = _ref.prevProps,\n          $self = _ref.$self;\n\n      var nextState = {\n        prevProps: props\n      };\n      if (prevProps && props !== prevProps) {\n        var equal = objectEqual(prevProps.animation, props.animation);\n        if (!equal) {\n          $self.setDefaultData(props.animation || {});\n          $self.timeline.resetAnimData();\n          $self.timeline.setDefaultData($self.defaultTweenData);\n        }\n      }\n      return nextState; // eslint-disable-line\n    }\n  }]);\n\n  function ScrollParallax(props) {\n    _classCallCheck(this, ScrollParallax);\n\n    var _this = _possibleConstructorReturn(this, (ScrollParallax.__proto__ || Object.getPrototypeOf(ScrollParallax)).call(this, props));\n\n    _this.setDefaultData = function (_vars) {\n      var vars = dataToArray(_vars);\n      var varsForIn = function varsForIn(item, i) {\n        var playScale = playScaleToArray(item.playScale).map(function (data) {\n          return data * _this.clientHeight;\n        });\n        var aItem = _extends({}, item);\n        delete aItem.playScale;\n        var cItem = _extends({}, item);\n        delete cItem.playScale;\n        cItem.delay = playScale[0];\n        aItem.delay = playScale[0];\n        cItem.duration = playScale[1] - playScale[0];\n        aItem.duration = playScale[1] - playScale[0];\n        cItem.onStart = null;\n        cItem.onUpdate = null;\n        cItem.onComplete = null;\n        cItem.onRepeat = null;\n        aItem.onStart = aItem.onStart || noop;\n        aItem.onComplete = aItem.onComplete || noop;\n        aItem.onUpdate = aItem.onUpdate || noop;\n        aItem.onStartBack = aItem.onStartBack || noop;\n        aItem.onCompleteBack = aItem.onCompleteBack || noop;\n        _this.defaultTweenData[i] = cItem;\n        _this.defaultData[i] = aItem;\n      };\n      vars.forEach(varsForIn);\n    };\n\n    _this.resizeEventListener = function () {\n      if (_this.defaultData[_this.defaultData.length - 1] && _this.defaultData[_this.defaultData.length - 1].onCompleteBool && !_this.props.always) {\n        return;\n      }\n      _this.scrollTop = currentScrollTop();\n      _this.target = _this.props.targetId && document.getElementById(_this.props.targetId);\n      _this.clientHeight = _this.target ? _this.target.clientHeight : windowHeight();\n      _this.setDefaultData(_this.props.animation || {});\n      if (_this.timeline) {\n        _this.timeline.resetDefaultStyle();\n      }\n      _this.timeline = new Timeline(_this.dom, _this.defaultTweenData);\n      _this.timeline.init();\n      _this.scrollEventListener();\n    };\n\n    _this.scrollEventListener = function () {\n      var scrollTop = _this.target ? _this.target.scrollTop : currentScrollTop();\n      _this.clientHeight = _this.target ? _this.target.clientHeight : windowHeight();\n      var dom = _this.props.location ? document.getElementById(_this.props.location) : _this.dom;\n      if (!dom) {\n        throw new Error('\"location\" is null');\n      }\n      var targetTop = _this.target ? _this.target.getBoundingClientRect().top : 0;\n      var offsetTop = dom.getBoundingClientRect().top + scrollTop - targetTop;\n      var elementShowHeight = scrollTop - offsetTop + _this.clientHeight;\n      var currentShow = _this.scrollTop - offsetTop + _this.clientHeight;\n      _this.defaultData.forEach(function (item, i) {\n        var duration = _this.defaultData.map(function (c, ii) {\n          return ii < i && c.delay + c.duration || 0;\n        }).reduce(function (a, b) {\n          return a + b;\n        });\n        var noUpdate = void 0;\n        if (elementShowHeight <= item.delay + duration) {\n          if (!item.onCompleteBackBool && item.onStartBool) {\n            item.onCompleteBackBool = true;\n            noUpdate = true;\n            item.onCompleteBack();\n          }\n        } else {\n          item.onCompleteBackBool = false;\n        }\n        if (elementShowHeight >= item.delay + duration) {\n          if (!item.onStartBool) {\n            item.onStartBool = true;\n            noUpdate = true;\n            item.onStart();\n          }\n        } else {\n          item.onStartBool = false;\n        }\n\n        if (elementShowHeight <= item.delay + item.duration + duration) {\n          if (!item.onStartBackBool && item.onCompleteBool) {\n            item.onStartBackBool = true;\n            noUpdate = true;\n            item.onStartBack();\n          }\n        } else {\n          item.onStartBackBool = false;\n        }\n\n        if (elementShowHeight >= item.delay + item.duration + duration) {\n          if (!item.onCompleteBool) {\n            item.onCompleteBool = true;\n            noUpdate = true;\n            item.onComplete();\n          }\n        } else {\n          item.onCompleteBool = false;\n        }\n        if (elementShowHeight >= item.delay + duration && elementShowHeight <= item.delay + item.duration + duration && !noUpdate) {\n          item.onUpdate(elementShowHeight / (item.delay + item.duration + duration));\n        }\n      });\n      ticker.clear(_this.tickerId);\n      _this.tickerId = 'scrollParallax' + Date.now() + '-' + tickerId;\n      tickerId++;\n      if (tickerId >= Number.MAX_VALUE) {\n        tickerId = 0;\n      }\n      var startFrame = ticker.frame;\n      ticker.wake(_this.tickerId, function () {\n        var moment = (ticker.frame - startFrame) * ticker.perFrame;\n        var ratio = easingTypes.easeOutQuad(moment, 0.08, 1, 300);\n        _this.timeline.frame(currentShow + ratio * (elementShowHeight - currentShow));\n        if (moment >= 300) {\n          ticker.clear(_this.tickerId);\n        }\n      });\n\n      _this.scrollTop = scrollTop;\n      // 如果不一直靠滚动来执行动画，always=false而且动画全执行完了，，删除scrollEvent;\n      if (_this.defaultData[_this.defaultData.length - 1].onCompleteBool && _this.eventType && !_this.props.always) {\n        EventListener.removeEventListener(_this.eventType, _this.scrollEventListener, _this.target);\n      }\n    };\n\n    _this.scrollTop = 0;\n    _this.defaultTweenData = [];\n    _this.defaultData = [];\n    _this.state = {\n      $self: _this\n    };\n    return _this;\n  }\n\n  _createClass(ScrollParallax, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this.dom = ReactDom.findDOMNode(this);\n      var date = Date.now();\n      var length = EventListener._listeners.scroll ? EventListener._listeners.scroll.length : 0;\n      this.eventType = 'scroll.scrollEvent' + date + length;\n      this.eventResize = 'resize.resizeEvent' + date + length;\n      this.resizeEventListener();\n      EventListener.addEventListener(this.eventResize, this.resizeEventListener, this.target);\n      // 预注册;\n      this.timeline.frame(0);\n\n      this.scrollEventListener();\n      EventListener.addEventListener(this.eventType, this.scrollEventListener, this.target);\n    }\n  }, {\n    key: 'componentWillUnmount',\n    value: function componentWillUnmount() {\n      EventListener.removeEventListener(this.eventType, this.scrollEventListener, this.target);\n      EventListener.removeEventListener(this.eventResize, this.resizeEventListener, this.target);\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _props = this.props,\n          animation = _props.animation,\n          always = _props.always,\n          component = _props.component,\n          location = _props.location,\n          targetId = _props.targetId,\n          componentProps = _props.componentProps,\n          props = _objectWithoutProperties(_props, ['animation', 'always', 'component', 'location', 'targetId', 'componentProps']);\n\n      var style = _extends({}, props.style);\n      Object.keys(style).forEach(function (p) {\n        if (p.indexOf('filter') >= 0 || p.indexOf('Filter') >= 0) {\n          // ['Webkit', 'Moz', 'Ms', 'ms'].forEach(prefix=> style[`${prefix}Filter`] = style[p]);\n          var transformArr = ['Webkit', 'Moz', 'Ms', 'ms'];\n          for (var i = 0; i < transformArr.length; i++) {\n            style[transformArr[i] + 'Filter'] = style[p];\n          }\n        }\n      });\n      props.style = style;\n      return React.createElement(this.props.component, _extends({}, props, componentProps));\n    }\n  }]);\n\n  return ScrollParallax;\n}(React.Component);\n\nScrollParallax.propTypes = {\n  component: PropTypes.any,\n  animation: PropTypes.any,\n  always: PropTypes.bool,\n  location: PropTypes.string,\n  children: PropTypes.any,\n  className: PropTypes.string,\n  style: PropTypes.any,\n  id: PropTypes.string,\n  targetId: PropTypes.string,\n  componentProps: PropTypes.object\n};\nScrollParallax.defaultProps = {\n  component: 'div',\n  always: true,\n  componentProps: {}\n};\n\n\nScrollParallax.isScrollParallax = true;\nexport default ScrollParallax;"]},"metadata":{},"sourceType":"module"}