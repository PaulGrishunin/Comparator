{"ast":null,"code":"import _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport easingTypes from 'tween-functions';\nimport requestAnimationFrame from 'raf';\nimport EventListener from './EventDispatcher';\nimport { currentScrollTop, getPassive, windowHeight, windowIsUndefined } from './util'; // 设置默认数据\n\nfunction defaultData(vars) {\n  return {\n    ease: vars.ease || 'easeInOutQuad',\n    duration: vars.duration || 450,\n    docHeight: vars.docHeight,\n    scrollInterval: vars.scrollInterval || 1000,\n    loop: vars.loop || false,\n    location: vars.location || []\n  };\n}\n\nvar passive = getPassive();\n\nvar ScrollScreenClass = function ScrollScreenClass() {\n  var _this = this;\n\n  _classCallCheck(this, ScrollScreenClass);\n\n  this.init = function (vars) {\n    _this.vars = defaultData(vars || {});\n    _this.rafID = -1;\n    _this.toHeight = -1;\n    _this.num = 0;\n\n    if (windowIsUndefined) {\n      return;\n    }\n\n    EventListener.addEventListener('wheel.scrollWheel', _this.onWheel, null, passive); // dom 在 didMount 后高度没出来，加 setTimeout; \n\n    setTimeout(_this.startScroll);\n  };\n\n  this.unMount = function () {\n    EventListener.removeEventListener('wheel.scrollWheel', _this.onWheel);\n  };\n\n  this.setCurrentNNum = function () {\n    var mapped = _this.mapped;\n    var winHeight = windowHeight();\n\n    if (!mapped.length) {\n      // 如果是空，采用一屏一滚;\n      var docHeight = _this.vars.docHeight || document.body.scrollHeight;\n      var scrollTopNum = _this.scrollTop / winHeight;\n      var docTopNum = docHeight / winHeight;\n      var docEndScreenHeight = docHeight % winHeight;\n      var currentOffset = _this.scrollTop % winHeight;\n      var currentTopScreen = Math.floor(scrollTopNum); // 判断最后一屏是否过中间 \n\n      var currentScreen = Math.ceil(scrollTopNum) === Math.floor(docTopNum) ? currentOffset / docEndScreenHeight : currentOffset / winHeight;\n      _this.num = Math.round(currentTopScreen + currentScreen);\n      _this.toHeight = _this.num * winHeight;\n    } else {\n      mapped.forEach(function (dom, i) {\n        var domOffsetTop = dom.offsetTop;\n        var domHeight = dom.getBoundingClientRect().height;\n\n        if (_this.scrollTop >= domOffsetTop && _this.scrollTop < domOffsetTop + domHeight) {\n          var exceed = (_this.scrollTop - dom.offsetTop) / domHeight; // 当前屏超过80%到下半屏, scrollOverPack 会动态改高度；\n\n          exceed = exceed > 0.8 ? 1 : 0;\n          _this.num = i + exceed;\n          _this.toHeight = domOffsetTop + exceed * domHeight;\n        }\n      });\n      var tooNum = void 0;\n      var endDom = mapped[mapped.length - 1];\n      var startDom = mapped[0];\n      var startManyHeight = startDom.offsetTop;\n\n      if (_this.scrollTop > endDom.offsetTop + endDom.getBoundingClientRect().height) {\n        tooNum = Math.ceil((_this.scrollTop - endDom.offsetTop - endDom.getBoundingClientRect().height) / winHeight);\n        _this.num = mapped.length + tooNum;\n        _this.toHeight = endDom.offsetTop + endDom.getBoundingClientRect().height + tooNum * winHeight;\n      } else if (_this.scrollTop < startManyHeight) {\n        var t = _this.scrollTop - startManyHeight;\n        tooNum = t > 0 ? Math.ceil(t / winHeight) : Math.floor(t / winHeight);\n        _this.num = tooNum;\n        var tc = Math.ceil(startManyHeight / winHeight);\n        _this.toHeight = (tc + tooNum) * winHeight;\n      }\n    }\n  };\n\n  this.startScroll = function () {\n    var mapped = _this.vars.location.map(function (str) {\n      return document.getElementById(str);\n    }).filter(function (c) {\n      return c;\n    });\n\n    _this.mapped = mapped;\n    _this.scrollTop = currentScrollTop();\n    _this.animEndScrollTop = _this.scrollTop;\n\n    _this.setCurrentNNum();\n\n    if (mapped[0] && mapped[0].offsetTop >= windowHeight()) {\n      console.warn('Warning: The first screen is not at the top, which may lead to poor scrolling effect, \"' + _this.vars.location[0] + '\" offsetTop ' + mapped[0].offsetTop + 'px.');\n    }\n\n    if (_this.toHeight !== _this.scrollTop) {\n      _this.initTime = Date.now();\n      _this.rafID = requestAnimationFrame(_this.raf);\n    } else {\n      _this.toHeight = -1;\n    }\n  };\n\n  this.raf = function () {\n    var duration = _this.vars.duration;\n    var now = Date.now();\n    var progressTime = now - _this.initTime > duration ? duration : now - _this.initTime;\n\n    var easeValue = easingTypes[_this.vars.ease](progressTime, _this.scrollTop, _this.toHeight, duration);\n\n    _this.animEndScrollTop = easeValue;\n    window.scrollTo(window.scrollX, easeValue);\n\n    if (progressTime === duration) {\n      _this.cancelRequestAnimationFrame();\n\n      setTimeout(function () {\n        _this.toHeight = -1;\n      }, _this.vars.scrollInterval);\n    } else {\n      _this.rafID = requestAnimationFrame(_this.raf);\n    }\n  };\n\n  this.cancelRequestAnimationFrame = function () {\n    requestAnimationFrame.cancel(_this.rafID);\n    _this.rafID = -1;\n  };\n\n  this.getComputedStyle = function (dom) {\n    return dom && document.defaultView && document.defaultView.getComputedStyle ? document.defaultView.getComputedStyle(dom) : {};\n  };\n\n  this.isScroll = function (dom, deltaY) {\n    var style = _this.getComputedStyle(dom);\n\n    var overflow = style.overflow;\n    var overflowY = style.overflowY;\n    var isScrollOverflow = overflow === 'auto' || overflow === 'scroll' || overflow === 'overlay' || overflowY === 'auto' || overflowY === 'scroll' || overflowY === 'overlay'; // dom.parentNode === document 解决在滚动条上滚动取不到 body;\n\n    if (dom === document.body || !dom || dom.parentNode === document) {\n      return false;\n    } else if (dom.scrollHeight > dom.offsetHeight && isScrollOverflow && dom.scrollTop + dom.offsetHeight + deltaY < dom.scrollHeight && dom.scrollTop + deltaY > 0) {\n      return true;\n    }\n\n    return _this.isScroll(dom.parentNode, deltaY);\n  };\n\n  this.limitNum = function (min, max) {\n    if (_this.vars.loop) {\n      _this.num = _this.num < min ? max : _this.num;\n      _this.num = _this.num > max ? min : _this.num;\n    } else {\n      _this.num = _this.num < min ? min : _this.num;\n      _this.num = _this.num > max ? max : _this.num;\n    }\n  };\n\n  this.onWheel = function (e) {\n    var deltaY = e.deltaY;\n\n    if (_this.isScroll(e.target, deltaY)) {\n      return;\n    }\n\n    e.preventDefault();\n    var mapped = _this.mapped;\n\n    if (_this.rafID === -1 && deltaY !== 0 && _this.toHeight === -1) {\n      var winHeight = windowHeight();\n      _this.scrollTop = currentScrollTop();\n      var docHeight = _this.vars.docHeight || document.body.scrollHeight;\n\n      if (_this.animEndScrollTop !== _this.scrollTop) {\n        _this.setCurrentNNum();\n      }\n\n      if (deltaY < 0) {\n        _this.num--;\n      } else if (deltaY > 0) {\n        _this.num++;\n      }\n\n      if (mapped.length) {\n        var endDom = mapped[mapped.length - 1];\n        var startDom = mapped[0];\n        var startManyHeight = startDom.offsetTop;\n        var startManyScale = startManyHeight ? Math.ceil(startManyHeight / winHeight) : 0;\n        var manyHeight = docHeight - endDom.offsetTop - endDom.getBoundingClientRect().height;\n        var manyScale = manyHeight ? Math.ceil(manyHeight / winHeight) : 0;\n\n        _this.limitNum(-startManyScale, mapped.length - 1 + manyScale);\n\n        var currentDom = mapped[_this.num];\n        _this.toHeight = currentDom ? currentDom.offsetTop : (startManyScale + _this.num) * winHeight;\n        _this.toHeight = _this.toHeight < 0 ? 0 : _this.toHeight;\n        _this.toHeight = _this.toHeight > docHeight - winHeight ? docHeight - winHeight : _this.toHeight;\n      } else {\n        _this.limitNum(0, Math.floor(docHeight / winHeight));\n\n        _this.toHeight = winHeight * _this.num;\n      }\n\n      _this.initTime = Date.now();\n      _this.rafID = requestAnimationFrame(_this.raf);\n    }\n  };\n};\n\nvar ScrollScreen = new ScrollScreenClass();\nexport default {\n  init: ScrollScreen.init,\n  unMount: ScrollScreen.unMount\n};","map":{"version":3,"sources":["/home/paul/Comparator/frontend/node_modules/rc-scroll-anim/es/ScrollScreen.js"],"names":["_classCallCheck","easingTypes","requestAnimationFrame","EventListener","currentScrollTop","getPassive","windowHeight","windowIsUndefined","defaultData","vars","ease","duration","docHeight","scrollInterval","loop","location","passive","ScrollScreenClass","_this","init","rafID","toHeight","num","addEventListener","onWheel","setTimeout","startScroll","unMount","removeEventListener","setCurrentNNum","mapped","winHeight","length","document","body","scrollHeight","scrollTopNum","scrollTop","docTopNum","docEndScreenHeight","currentOffset","currentTopScreen","Math","floor","currentScreen","ceil","round","forEach","dom","i","domOffsetTop","offsetTop","domHeight","getBoundingClientRect","height","exceed","tooNum","endDom","startDom","startManyHeight","t","tc","map","str","getElementById","filter","c","animEndScrollTop","console","warn","initTime","Date","now","raf","progressTime","easeValue","window","scrollTo","scrollX","cancelRequestAnimationFrame","cancel","getComputedStyle","defaultView","isScroll","deltaY","style","overflow","overflowY","isScrollOverflow","parentNode","offsetHeight","limitNum","min","max","e","target","preventDefault","startManyScale","manyHeight","manyScale","currentDom","ScrollScreen"],"mappings":"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","sourcesContent":["import _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport easingTypes from 'tween-functions';\nimport requestAnimationFrame from 'raf';\nimport EventListener from './EventDispatcher';\nimport { currentScrollTop, getPassive, windowHeight, windowIsUndefined } from './util';\n\n// 设置默认数据\nfunction defaultData(vars) {\n  return {\n    ease: vars.ease || 'easeInOutQuad',\n    duration: vars.duration || 450,\n    docHeight: vars.docHeight,\n    scrollInterval: vars.scrollInterval || 1000,\n    loop: vars.loop || false,\n    location: vars.location || []\n  };\n}\n\nvar passive = getPassive();\n\nvar ScrollScreenClass = function ScrollScreenClass() {\n  var _this = this;\n\n  _classCallCheck(this, ScrollScreenClass);\n\n  this.init = function (vars) {\n    _this.vars = defaultData(vars || {});\n    _this.rafID = -1;\n    _this.toHeight = -1;\n    _this.num = 0;\n    if (windowIsUndefined) {\n      return;\n    }\n    EventListener.addEventListener('wheel.scrollWheel', _this.onWheel, null, passive);\n    // dom 在 didMount 后高度没出来，加 setTimeout; \n    setTimeout(_this.startScroll);\n  };\n\n  this.unMount = function () {\n    EventListener.removeEventListener('wheel.scrollWheel', _this.onWheel);\n  };\n\n  this.setCurrentNNum = function () {\n    var mapped = _this.mapped;\n    var winHeight = windowHeight();\n    if (!mapped.length) {\n      // 如果是空，采用一屏一滚;\n      var docHeight = _this.vars.docHeight || document.body.scrollHeight;\n      var scrollTopNum = _this.scrollTop / winHeight;\n      var docTopNum = docHeight / winHeight;\n      var docEndScreenHeight = docHeight % winHeight;\n      var currentOffset = _this.scrollTop % winHeight;\n      var currentTopScreen = Math.floor(scrollTopNum);\n      // 判断最后一屏是否过中间 \n      var currentScreen = Math.ceil(scrollTopNum) === Math.floor(docTopNum) ? currentOffset / docEndScreenHeight : currentOffset / winHeight;\n      _this.num = Math.round(currentTopScreen + currentScreen);\n      _this.toHeight = _this.num * winHeight;\n    } else {\n      mapped.forEach(function (dom, i) {\n        var domOffsetTop = dom.offsetTop;\n        var domHeight = dom.getBoundingClientRect().height;\n        if (_this.scrollTop >= domOffsetTop && _this.scrollTop < domOffsetTop + domHeight) {\n          var exceed = (_this.scrollTop - dom.offsetTop) / domHeight;\n          // 当前屏超过80%到下半屏, scrollOverPack 会动态改高度；\n          exceed = exceed > 0.8 ? 1 : 0;\n          _this.num = i + exceed;\n          _this.toHeight = domOffsetTop + exceed * domHeight;\n        }\n      });\n      var tooNum = void 0;\n      var endDom = mapped[mapped.length - 1];\n      var startDom = mapped[0];\n      var startManyHeight = startDom.offsetTop;\n\n      if (_this.scrollTop > endDom.offsetTop + endDom.getBoundingClientRect().height) {\n        tooNum = Math.ceil((_this.scrollTop - endDom.offsetTop - endDom.getBoundingClientRect().height) / winHeight);\n        _this.num = mapped.length + tooNum;\n        _this.toHeight = endDom.offsetTop + endDom.getBoundingClientRect().height + tooNum * winHeight;\n      } else if (_this.scrollTop < startManyHeight) {\n        var t = _this.scrollTop - startManyHeight;\n        tooNum = t > 0 ? Math.ceil(t / winHeight) : Math.floor(t / winHeight);\n        _this.num = tooNum;\n        var tc = Math.ceil(startManyHeight / winHeight);\n        _this.toHeight = (tc + tooNum) * winHeight;\n      }\n    }\n  };\n\n  this.startScroll = function () {\n    var mapped = _this.vars.location.map(function (str) {\n      return document.getElementById(str);\n    }).filter(function (c) {\n      return c;\n    });\n    _this.mapped = mapped;\n    _this.scrollTop = currentScrollTop();\n    _this.animEndScrollTop = _this.scrollTop;\n    _this.setCurrentNNum();\n    if (mapped[0] && mapped[0].offsetTop >= windowHeight()) {\n      console.warn('Warning: The first screen is not at the top, which may lead to poor scrolling effect, \"' + _this.vars.location[0] + '\" offsetTop ' + mapped[0].offsetTop + 'px.');\n    }\n    if (_this.toHeight !== _this.scrollTop) {\n      _this.initTime = Date.now();\n      _this.rafID = requestAnimationFrame(_this.raf);\n    } else {\n      _this.toHeight = -1;\n    }\n  };\n\n  this.raf = function () {\n    var duration = _this.vars.duration;\n    var now = Date.now();\n    var progressTime = now - _this.initTime > duration ? duration : now - _this.initTime;\n    var easeValue = easingTypes[_this.vars.ease](progressTime, _this.scrollTop, _this.toHeight, duration);\n    _this.animEndScrollTop = easeValue;\n    window.scrollTo(window.scrollX, easeValue);\n    if (progressTime === duration) {\n      _this.cancelRequestAnimationFrame();\n      setTimeout(function () {\n        _this.toHeight = -1;\n      }, _this.vars.scrollInterval);\n    } else {\n      _this.rafID = requestAnimationFrame(_this.raf);\n    }\n  };\n\n  this.cancelRequestAnimationFrame = function () {\n    requestAnimationFrame.cancel(_this.rafID);\n    _this.rafID = -1;\n  };\n\n  this.getComputedStyle = function (dom) {\n    return dom && document.defaultView && document.defaultView.getComputedStyle ? document.defaultView.getComputedStyle(dom) : {};\n  };\n\n  this.isScroll = function (dom, deltaY) {\n    var style = _this.getComputedStyle(dom);\n    var overflow = style.overflow;\n    var overflowY = style.overflowY;\n    var isScrollOverflow = overflow === 'auto' || overflow === 'scroll' || overflow === 'overlay' || overflowY === 'auto' || overflowY === 'scroll' || overflowY === 'overlay';\n    // dom.parentNode === document 解决在滚动条上滚动取不到 body;\n    if (dom === document.body || !dom || dom.parentNode === document) {\n      return false;\n    } else if (dom.scrollHeight > dom.offsetHeight && isScrollOverflow && dom.scrollTop + dom.offsetHeight + deltaY < dom.scrollHeight && dom.scrollTop + deltaY > 0) {\n      return true;\n    }\n    return _this.isScroll(dom.parentNode, deltaY);\n  };\n\n  this.limitNum = function (min, max) {\n    if (_this.vars.loop) {\n      _this.num = _this.num < min ? max : _this.num;\n      _this.num = _this.num > max ? min : _this.num;\n    } else {\n      _this.num = _this.num < min ? min : _this.num;\n      _this.num = _this.num > max ? max : _this.num;\n    }\n  };\n\n  this.onWheel = function (e) {\n    var deltaY = e.deltaY;\n    if (_this.isScroll(e.target, deltaY)) {\n      return;\n    }\n    e.preventDefault();\n\n    var mapped = _this.mapped;\n    if (_this.rafID === -1 && deltaY !== 0 && _this.toHeight === -1) {\n      var winHeight = windowHeight();\n      _this.scrollTop = currentScrollTop();\n      var docHeight = _this.vars.docHeight || document.body.scrollHeight;\n      if (_this.animEndScrollTop !== _this.scrollTop) {\n        _this.setCurrentNNum();\n      }\n      if (deltaY < 0) {\n        _this.num--;\n      } else if (deltaY > 0) {\n        _this.num++;\n      }\n      if (mapped.length) {\n        var endDom = mapped[mapped.length - 1];\n        var startDom = mapped[0];\n        var startManyHeight = startDom.offsetTop;\n        var startManyScale = startManyHeight ? Math.ceil(startManyHeight / winHeight) : 0;\n        var manyHeight = docHeight - endDom.offsetTop - endDom.getBoundingClientRect().height;\n        var manyScale = manyHeight ? Math.ceil(manyHeight / winHeight) : 0;\n        _this.limitNum(-startManyScale, mapped.length - 1 + manyScale);\n        var currentDom = mapped[_this.num];\n        _this.toHeight = currentDom ? currentDom.offsetTop : (startManyScale + _this.num) * winHeight;\n        _this.toHeight = _this.toHeight < 0 ? 0 : _this.toHeight;\n        _this.toHeight = _this.toHeight > docHeight - winHeight ? docHeight - winHeight : _this.toHeight;\n      } else {\n        _this.limitNum(0, Math.floor(docHeight / winHeight));\n        _this.toHeight = winHeight * _this.num;\n      }\n      _this.initTime = Date.now();\n      _this.rafID = requestAnimationFrame(_this.raf);\n    }\n  };\n};\n\nvar ScrollScreen = new ScrollScreenClass();\nexport default {\n  init: ScrollScreen.init,\n  unMount: ScrollScreen.unMount\n};"]},"metadata":{},"sourceType":"module"}